<html>
  <head>
    <title>Net::SSH Manual :: Chapter 7: Using Proxies</title>
    <link type="text/css" rel="stylesheet" href="stylesheets/manual.css" />
  </head>
  
  <body>
    <div id="banner">
      <table border='0' cellpadding='0' cellspacing='0' width='100%'>
        <tr><td valign='top' align='left'>
          <div class="title">
            <span class="product">Net::SSH&mdash;</span><br />
            <span class="tagline">Secure Shell for Ruby</span>
          </div>
        </td><td valign='middle' align='right'>
          <div class="info">
            Net::SSH Version: <strong>1.1.2</strong><br />
            Manual Last Updated: <strong>2007-06-18 18:12 UTC</strong>
          </div>
        </td></tr>
      </table>
    </div>

    <table border='0' width='100%' cellpadding='0' cellspacing='0'>
      <tr><td valign='top'>

        <div id="navigation">
          <h1>Net::SSH Manual</h1>

          <h2>Chapters</h2>
          <ol type="I">
          
            <li>
                <a href="chapter-1.html">
                Introduction
                </a>
                
              <ol type="1">
                
                  <li><a href="chapter-1.html#s1">What is Net::SSH?</a></li>
                
                  <li><a href="chapter-1.html#s2">What isn&#8217;t Net::SSH?</a></li>
                
                  <li><a href="chapter-1.html#s3">Getting Net::SSH</a></li>
                
                  <li><a href="chapter-1.html#s4">License Information</a></li>
                
                  <li><a href="chapter-1.html#s5">Support</a></li>
                
                  <li><a href="chapter-1.html#s6">About the Author</a></li>
                
              </ol>
            </li>
          
            <li>
                <a href="chapter-2.html">
                Starting a Session
                </a>
                
              <ol type="1">
                
                  <li><a href="chapter-2.html#s1">Using Net::SSH.start</a></li>
                
                  <li><a href="chapter-2.html#s2">Using a Public/Private Key</a></li>
                
                  <li><a href="chapter-2.html#s3">Options</a></li>
                
                  <li><a href="chapter-2.html#s4">Using Net::SSH::Session</a></li>
                
              </ol>
            </li>
          
            <li>
                <a href="chapter-3.html">
                Channels
                </a>
                
              <ol type="1">
                
                  <li><a href="chapter-3.html#s1">What are Channels?</a></li>
                
                  <li><a href="chapter-3.html#s2">Session.loop</a></li>
                
                  <li><a href="chapter-3.html#s3">Channel Types</a></li>
                
                  <li><a href="chapter-3.html#s4">Opening a Channel</a></li>
                
                  <li><a href="chapter-3.html#s5">Callbacks</a></li>
                
                  <li><a href="chapter-3.html#s6">Channel Operations</a></li>
                
              </ol>
            </li>
          
            <li>
                <a href="chapter-4.html">
                Executing Commands
                </a>
                
              <ol type="1">
                
                  <li><a href="chapter-4.html#s1">Using Channels</a></li>
                
                  <li><a href="chapter-4.html#s2">Using #process.open</a></li>
                
                  <li><a href="chapter-4.html#s3">Using #process.popen3</a></li>
                
              </ol>
            </li>
          
            <li>
                <a href="chapter-5.html">
                User Shells
                </a>
                
              <ol type="1">
                
                  <li><a href="chapter-5.html#s1">Introduction</a></li>
                
                  <li><a href="chapter-5.html#s2">Using Channels</a></li>
                
                  <li><a href="chapter-5.html#s3">Shell Service</a></li>
                
                  <li><a href="chapter-5.html#s4">SyncShell Service</a></li>
                
                  <li><a href="chapter-5.html#s5">Terminal Clients</a></li>
                
              </ol>
            </li>
          
            <li>
                <a href="chapter-6.html">
                Port Forwarding
                </a>
                
              <ol type="1">
                
                  <li><a href="chapter-6.html#s1">Introduction</a></li>
                
                  <li><a href="chapter-6.html#s2">Local-to-Remote</a></li>
                
                  <li><a href="chapter-6.html#s3">Remote-to-Local</a></li>
                
                  <li><a href="chapter-6.html#s4">Direct Channels</a></li>
                
                  <li><a href="chapter-6.html#s5">Remote-to-Local Handlers</a></li>
                
              </ol>
            </li>
          
            <li><strong>
                <a href="chapter-7.html">
                Using Proxies
                </a>
                </strong> <big>&larr;</big>
              <ol type="1">
                
                  <li><a href="chapter-7.html#s1">Introduction</a></li>
                
                  <li><a href="chapter-7.html#s2"><span class="caps">HTTP</span></a></li>
                
                  <li><a href="chapter-7.html#s3"><span class="caps">SOCKS</span></a></li>
                
              </ol>
            </li>
          
          </ol>

          <h2>Other Documentation</h2>

          <ul>
            <li><a href="http://net-ssh.rubyforge.org/api/index.html">Net::SSH API</a></li>
            <li><a href="http://rubyforge.org/tracker/?atid=1842&group_id=274&func=browse">Net::SSH FAQ</a></li>
          </ul>

          <h2>Tutorials</h2>
          <ol>
          
          </ol>

          <p align="center"><strong>More To Come...</strong></p>

          <div class="license">
            <a href="http://creativecommons.org/licenses/by-sa/2.0/"><img alt="Creative Commons License" border="0" src="http://creativecommons.org/images/public/somerights" /></a><br />
            This manual is licensed under a <a href="http://creativecommons.org/licenses/by-sa/2.0/">Creative Commons License</a>.
          </div>
        </div>

      </td><td valign='top' width="100%">

        <div id="content">

           <div class="top"><div class="prevnext">
  
    <a href="chapter-6.html">Previous (6. Port Forwarding)</a> |
  
  <a href="index.html">Up</a>
  
</div></div>

<h1>7. Using Proxies</h1>



     <h2>
       <a name="s1"></a>
       7.1. Introduction
     </h2>

   

   <div class="section">
     <p>Many times, you may find yourself behind a firewall, unable to <span class="caps">SSH</span> out. In such instances, you can often take advantage of your existing proxies to tunnel an <span class="caps">SSH</span> connection through your firewall.</p>
   </div>



     <h2>
       <a name="s2"></a>
       7.2. <span class="caps">HTTP</span>
     </h2>

   

   <div class="section">
     <p>If you have an <span class="caps">HTTP</span> proxy running, you may be able to use it to your advantage.  The following snippet demonstrates how to tunnel an <span class="caps">SSH</span> connection through an <span class="caps">HTTP</span> proxy:</p>


	<div class='figure'>
<span class='caption'>Tunnelling an SSH connection over HTTP [ruby]</span>
<div class='body'><table border='0' cellpadding='0' cellspacing='0'><tr><td class='lineno'>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br /></td><td width='100%'><link rel='stylesheet' type='text/css' href='stylesheets/ruby.css' /><div class='ruby'><pre><span class="ident">require</span> <span class="punct">'</span><span class="string">net/ssh</span><span class="punct">'</span>
<span class="ident">require</span> <span class="punct">'</span><span class="string">net/ssh/proxy/http</span><span class="punct">'</span>

<span class="ident">proxy_host</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">my.proxy.com</span><span class="punct">'</span>
<span class="ident">proxy_port</span> <span class="punct">=</span> <span class="number">8080</span>
<span class="ident">proxy</span> <span class="punct">=</span> <span class="constant">Net</span><span class="punct">::</span><span class="constant">SSH</span><span class="punct">::</span><span class="constant">Proxy</span><span class="punct">::</span><span class="constant">HTTP</span><span class="punct">.</span><span class="ident">new</span><span class="punct">(</span> <span class="ident">proxy_host</span><span class="punct">,</span> <span class="ident">proxy_port</span> <span class="punct">)</span>

<span class="constant">Net</span><span class="punct">::</span><span class="constant">SSH</span><span class="punct">.</span><span class="ident">start</span><span class="punct">(</span> <span class="punct">'</span><span class="string">host</span><span class="punct">',</span> <span class="symbol">:proxy</span> <span class="punct">=&gt;</span> <span class="ident">proxy</span> <span class="punct">)</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">session</span><span class="punct">|</span>
  <span class="punct">...</span>
<span class="keyword">end</span></pre></div></td></tr></table></div></div>


	<p>As you can see, you first create an instance of the proxy you want to use. (This flexibility allows for other proxy types to be supported, although at present only <span class="caps">HTTP</span> and <span class="caps">SOCKS</span> are available.)</p>


	<p>Once you&#8217;ve created your proxy, you just start your <span class="caps">SSH</span> session, as usual, except you also pass a <code>:proxy</code> option. The proxy will then be used to obtain a connection to the remote host.</p>


	<p>Note: If your proxy does not allow connects to be made to other hosts on port 22, then you&#8217;ll have to do some magic to allow <span class="caps">SSH</span> connections on your remote host on ports other than 22. Port forwarding on that remote host (from itself, to itself), can help you there.</p>


	<p>For instance, if your proxy disallows connections to any port except (say) 443, you could run the following command on the remote host:</p>


	<div class='figure'>
<span class='caption'>Forwarding a port using the ssh command [shell]</span>
<div class='body'><link rel='stylesheet' type='text/css' href='stylesheets/shell.css' /><div class='shell'><pre>ssh -gL 443:localhost:22 localhost</pre></div></div></div>


	<p>Then, as long as that command is running, port 443 will always be forwarded to port 22.  Naturally, this means that you must run this command while you have access to the box; if you can&#8217;t access that machine in the first place (ie, because you&#8217;re behind a firewall), then it does you no good.</p>


	<h3>Proxy Authentication</h3>


	<p>Some proxies require authentication. Net::SSH supports these proxies as well. If you specify the user name either as a <code>:user</code> option to the <span class="caps">HTTP</span> proxy constructor, or in the <code>HTTP_PROXY_USER</code> or <code>CONNECT_USER</code> environment variables, that name will be used to authenticate with the proxy. Likewise, the password may be given either via the <code>:password</code> constructor option, or via the <code>HTTP_PROXY_PASSWORD</code> or <code>CONNECT_PASSWORD</code> environment variables.</p>


	<div class='figure'>
<span class='caption'>Using HTTP proxy authentication [ruby]</span>
<div class='body'><table border='0' cellpadding='0' cellspacing='0'><tr><td class='lineno'>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br /></td><td width='100%'><link rel='stylesheet' type='text/css' href='stylesheets/ruby.css' /><div class='ruby'><pre><span class="ident">require</span> <span class="punct">'</span><span class="string">net/ssh</span><span class="punct">'</span>
<span class="ident">require</span> <span class="punct">'</span><span class="string">net/ssh/proxy/http</span><span class="punct">'</span>

<span class="ident">proxy_host</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">my.proxy.com</span><span class="punct">'</span>
<span class="ident">proxy_port</span> <span class="punct">=</span> <span class="number">8080</span>
<span class="ident">proxy_user</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">my-name</span><span class="punct">'</span>
<span class="ident">proxy_password</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">my-password</span><span class="punct">'</span>

<span class="ident">proxy</span> <span class="punct">=</span> <span class="constant">Net</span><span class="punct">::</span><span class="constant">SSH</span><span class="punct">::</span><span class="constant">Proxy</span><span class="punct">::</span><span class="constant">HTTP</span><span class="punct">.</span><span class="ident">new</span><span class="punct">(</span> <span class="ident">proxy_host</span><span class="punct">,</span> <span class="ident">proxy_port</span><span class="punct">,</span>
            <span class="symbol">:user</span> <span class="punct">=&gt;</span> <span class="ident">proxy_user</span><span class="punct">,</span>
            <span class="symbol">:password</span> <span class="punct">=&gt;</span> <span class="ident">proxy_password</span> <span class="punct">)</span>

<span class="constant">Net</span><span class="punct">::</span><span class="constant">SSH</span><span class="punct">.</span><span class="ident">start</span><span class="punct">(</span> <span class="punct">'</span><span class="string">host</span><span class="punct">',</span> <span class="symbol">:proxy</span> <span class="punct">=&gt;</span> <span class="ident">proxy</span> <span class="punct">)</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">session</span><span class="punct">|</span>
  <span class="punct">...</span>
<span class="keyword">end</span></pre></div></td></tr></table></div></div>


	<p>Note that currently, only basic authentication is supported; in the future, digest authentication may be added for proxies that support it.</p>
   </div>



     <h2>
       <a name="s3"></a>
       7.3. <span class="caps">SOCKS</span>
     </h2>

   

   <div class="section">
     <p>In addition to the <span class="caps">HTTP</span> proxy, Net::SSH also supports <span class="caps">SOCKS</span> proxies (both versions 4 and 5). Their usage is almost identical to the <span class="caps">HTTP</span> version (except <span class="caps">SOCKS4</span> does not use passwords, just user names):</p>


	<div class='figure'>
<span class='caption'>Using SOCKS proxies [ruby]</span>
<div class='body'><table border='0' cellpadding='0' cellspacing='0'><tr><td class='lineno'>1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br /></td><td width='100%'><link rel='stylesheet' type='text/css' href='stylesheets/ruby.css' /><div class='ruby'><pre><span class="ident">require</span> <span class="punct">'</span><span class="string">net/ssh</span><span class="punct">'</span>
<span class="ident">require</span> <span class="punct">'</span><span class="string">net/ssh/proxy/socks4</span><span class="punct">'</span>
<span class="ident">require</span> <span class="punct">'</span><span class="string">net/ssh/proxy/socks5</span><span class="punct">'</span>

<span class="ident">proxy_host</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">my.proxy.com</span><span class="punct">'</span>
<span class="ident">proxy_port</span> <span class="punct">=</span> <span class="number">1080</span>
<span class="ident">proxy_user</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">my-name</span><span class="punct">'</span>
<span class="ident">proxy_password</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">my-password</span><span class="punct">'</span>

<span class="ident">socks4</span> <span class="punct">=</span> <span class="constant">Net</span><span class="punct">::</span><span class="constant">SSH</span><span class="punct">::</span><span class="constant">Proxy</span><span class="punct">::</span><span class="constant">SOCKS4</span><span class="punct">.</span><span class="ident">new</span><span class="punct">(</span> <span class="ident">proxy_host</span><span class="punct">,</span> <span class="ident">proxy_port</span><span class="punct">,</span>
            <span class="symbol">:user</span> <span class="punct">=&gt;</span> <span class="ident">proxy_user</span> <span class="punct">)</span>

<span class="ident">socks5</span> <span class="punct">=</span> <span class="constant">Net</span><span class="punct">::</span><span class="constant">SSH</span><span class="punct">::</span><span class="constant">Proxy</span><span class="punct">::</span><span class="constant">SOCKS5</span><span class="punct">.</span><span class="ident">new</span><span class="punct">(</span> <span class="ident">proxy_host</span><span class="punct">,</span> <span class="ident">proxy_port</span><span class="punct">,</span>
            <span class="symbol">:user</span> <span class="punct">=&gt;</span> <span class="ident">proxy_user</span><span class="punct">,</span>
            <span class="symbol">:password</span> <span class="punct">=&gt;</span> <span class="ident">proxy_password</span><span class="punct">)</span>

<span class="constant">Net</span><span class="punct">::</span><span class="constant">SSH</span><span class="punct">.</span><span class="ident">start</span><span class="punct">(</span> <span class="punct">'</span><span class="string">host</span><span class="punct">',</span> <span class="symbol">:proxy</span> <span class="punct">=&gt;</span> <span class="ident">socks4</span> <span class="punct">)</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">session</span><span class="punct">|</span>
  <span class="punct">...</span>
<span class="keyword">end</span></pre></div></td></tr></table></div></div>
   </div>



<div class="bottom"><div class="prevnext">
  
    <a href="chapter-6.html">Previous (6. Port Forwarding)</a> |
  
  <a href="index.html">Up</a>
  
</div></div>


        </div>

      </td></tr>
    </table>
  </body>
</html>
